<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Generating proto code from Weave specification · Weave SDK Documentations</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="To connect to Weave based applications, first you need to be able to generate proto code using [Weave spec](https://github.com/iov-one/weave/tree/v1.0.0/spec)."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Generating proto code from Weave specification · Weave SDK Documentations"/><meta property="og:type" content="website"/><meta property="og:url" content="https://weave.iov.one/"/><meta property="og:description" content="To connect to Weave based applications, first you need to be able to generate proto code using [Weave spec](https://github.com/iov-one/weave/tree/v1.0.0/spec)."/><meta property="og:image" content="https://weave.iov.one/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://weave.iov.one/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Weave SDK Documentations"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://github.com/iov-one" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>API specifications</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/intro">Welcome to IOV!</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">IOV Weave SDK<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/weave/welcome">Welcome</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Basics</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/basics/blockchain">Blockchain</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/consensus">Consensus</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/authentication">Authentication</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/state">State Machine</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Design</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/design/overview">Guiding Design Principles</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/extension">Extension</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/transaction-flow">Flow of Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/queries">Queries</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/prototool">Prototool</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Configuration</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/configuration/application">Application</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API specifications</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/address-derivation">Address Derivation</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/weave/weave-api-spec/protoc-generation-spec">Generating proto code</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/weave-transaction-spec">Weave Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/tx-sign-spec">Transaction Signatures</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/weave-query-spec">Querying Weave</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/modules">Modules</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Tutorial</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/domain">Domain</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/codec">Codec</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/models">Models</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/messages">Messages</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/buckets">Buckets</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/handlers">Handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/app-level-codec">Application Level Codec</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/application">Application</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/batch-txs">Batch Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/cron-tasks">Scheduled Tasks</a></li></ul></div></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Generating proto code from Weave specification</h1></header><article><div><span><p>To connect to Weave based applications, first you need to be able to generate proto code using <a href="https://github.com/iov-one/weave/tree/v1.0.0/spec">Weave spec</a>.</p>
<p><strong>Before diving into this documentation we recommend you to go over <a href="/docs/weave/design/prototool">Weave design codec doc</a> first and then <a href="/docs/weave/tutorial/codec">Tutorial codec docs</a></strong></p>
<p>When you take a look at spec folder you will see couple directories that are using in various ways.</p>
<ul>
<li><a href="https://github.com/iov-one/weave/tree/v1.0.0/spec/gogo">spec/gogo</a> contains gogo proto annotations that are pretty useful when generating better shaped go code.</li>
<li><a href="https://github.com/iov-one/weave/tree/v1.0.0/spec/gogo">spec/proto</a> contains bare proto definitions that could be used to generate code for various languages that has protoc generator or plugin.</li>
</ul>
<p>If you are aiming to use go, we are happy with gogo plugin and we advise you use gogo spec folder for proto code generation. Here is an example for this case: <a href="https://github.com/iov-one/blog-tutorial/">blog-tutorial</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="steps"></a><a href="#steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Steps</h2>
<p>You can see the output of the steps below here: <a href="https://github.com/iov-one/blog-tutorial/">blog-tutorial</a>, <a href="https://github.com/cosmostation/cosmostation-mobile/tree/master/Cosmos-Android/app/src/main/java/wannabit/io/cosmostaion/iov-one/bns">Cosmostation java integration</a>, <a href="https://github.com/cosmostation/cosmostation-mobile/tree/master/Cosmos-IOS/Cosmostation/Cosmostation/IOV/bns">Cosmostation swift integration</a></p>
<h3><a class="anchor" aria-hidden="true" id="install-protocprototool"></a><a href="#install-protocprototool" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install protoc/prototool</h3>
<p>Instead of using bare protoc, We recommend using prototool if your language is supported by the project. <a href="https://github.com/uber/prototool/blob/dev/etc/config/example/prototool.yaml#L129-L190">Check it out here</a>. If your language is in the list you are very lucky and saved a lot of manual future work. You can use <a href="https://github.com/iov-one/prototool-docker">prototool docker</a> for more convenient usage. Prototool contains protoc as dependency so no need to install protoc individually. If not, download prototool again but not the docker version. We will need it later.
You can install protoc compiler <a href="https://github.com/protocolbuffers/protobuf#protocol-compiler-installation">here</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="download-the-spec-folder"></a><a href="#download-the-spec-folder" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Download the spec folder</h3>
<p>Downloading for go code is fairly simple. You can take a look at <a href="https://github.com/iov-one/blog-tutorial/blob/master/Makefile#L20">blog-tutorial/makefile</a>. <code>import-spec</code> command gets the spec folder based on the Weave version is based on.</p>
<p>On the other hand for other languages than go, you have to download the spec manually or by an automated script. We provide spec folder in <a href="https://github.com/iov-one/weave/releases/tag/v1.0.0">releases</a>. You can download it down below in that page.</p>
<h3><a class="anchor" aria-hidden="true" id="import-prototoolyaml"></a><a href="#import-prototoolyaml" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Import prototool.yaml</h3>
<p>Even if prototool does not support your language, it is still very useful. Normally with protoc you have to <a href="https://developers.google.com/protocol-buffers/docs/javatutorial#compiling-your-protocol-buffers">feed protoc dependencies</a> with <code>-I</code> argument to protoc. This is pretty much the same in other language plugins. But it is very time consuming to do with hand. So instead of writing this script manually, you can get the protoc commands that are run by prototool in the background with <code>prototool generate --dry-run</code>. After that with some bash string manipulation you are ready to generate code.</p>
<h3><a class="anchor" aria-hidden="true" id="generating-code"></a><a href="#generating-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating code</h3>
<p>With prototool, generation is simple: Go to the folder that contains <code>prototool.yaml</code> (folder you want to generate the code to) and the run <code>prototool generate</code>. You can tweak the prototool configuration (such as generated code directory) to suit your needs.
But without prototool, it is bit more work. After getting the <code>prototool generate --dry-run</code>, change the <code>--java_out</code> or <code>--go_out</code> to output argument that is used by protoc plugin you choose. Note: there could be more configuration or arguments to make it work. Read the plugin manual :)</p>
<p>Now as output you should have something like:</p>
<pre><code class="hljs css language-bash">/Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/bin/protoc -I /spec_folder/IOV/bns/spec/proto -I /Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/include --haskell_out=/spec_folder/IOV/bns/gen/swift /spec_folder/IOV/bns/spec/proto/cmd/bnsd/x/account/codec.proto
/Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/bin/protoc -I /spec_folder/IOV/bns/spec/proto -I /Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/include --haskell_out=/spec_folder/IOV/bns/gen/swift /spec_folder/IOV/bns/spec/proto/x/sigs/codec.proto
/Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/bin/protoc -I /spec_folder/IOV/bns/spec/proto -I /Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/include --haskell_out=/spec_folder/IOV/bns/gen/swift /spec_folder/IOV/bns/spec/proto/x/gov/codec.proto /spec_folder/IOV/bns/spec/proto/x/gov/sample_test.proto
/Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/bin/protoc -I /spec_folder/IOV/bns/spec/proto -I /Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/include --haskell_out=/spec_folder/IOV/bns/gen/swift /spec_folder/IOV/bns/spec/proto/crypto/models.proto
/Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/bin/protoc -I /spec_folder/IOV/bns/spec/proto -I /Users/username/Library/Caches/prototool/Darwin/x86_64/protobuf/3.7.1/include --haskell_out=/spec_folder/IOV/bns/gen/swift /spec_folder/IOV/bns/spec/proto/x/txfee/codec.proto ....
...
</code></pre>
<p>After copy-pasting this command to terminal, generated Haskell(whatever the language is) code is ready. You can use the generated code to build transactions and use Weave models in your app to reduce the workload.</p>
<h2><a class="anchor" aria-hidden="true" id="helpful-links"></a><a href="#helpful-links" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Helpful links</h2>
<p>Golang code reference:</p>
<ul>
<li><a href="https://github.com/iov-one/blog-tutorial/">blog-tutorial</a>. See <code>makefile</code>, <code>prototool.yaml</code> and <code>spec</code> folder.</li>
</ul>
<p>We collaborated with cosmostation to automate this process. Here are the script for reference:</p>
<ul>
<li>Android(Java): <a href="https://github.com/cosmostation/cosmostation-mobile/blob/master/Cosmos-Android/app/src/main/java/wannabit/io/cosmostaion/iov-one/bns/generate_proto.sh">Cosmostation/Cosmos-Android</a></li>
<li>Swift(IOS): <a href="https://github.com/cosmostation/cosmostation-mobile/blob/master/Cosmos-IOS/Cosmostation/Cosmostation/IOV/bns/generate_proto.sh">Cosmostation/Cosmos-IOS</a></li>
</ul>
</span></div></article></div><div class="docLastUpdate"><em>Last updated by orkunkl</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/weave/weave-api-spec/address-derivation"><span class="arrow-prev">← </span><span>Address Derivation</span></a><a class="docs-next button" href="/docs/weave/weave-api-spec/weave-transaction-spec"><span>Weave Transactions</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#steps">Steps</a><ul class="toc-headings"><li><a href="#install-protocprototool">Install protoc/prototool</a></li><li><a href="#download-the-spec-folder">Download the spec folder</a></li><li><a href="#import-prototoolyaml">Import prototool.yaml</a></li><li><a href="#generating-code">Generating code</a></li></ul></li><li><a href="#helpful-links">Helpful links</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Docs</h5><a href="/docs/iov-name-service/validator/rewards">IOV Name Service</a><a href="/docs/weave/welcome">Weave</a></div><div><h5>Community</h5><a href="https://riot.im/app/#/room/#weave:matrix.org" target="_blank">Riot Chat</a><a href="https://t.me/internetofvalues" target="_blank">Telegram</a><a href="https://twitter.com/iov_official" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/iov-one" target="_blank">GitHub</a><a href="https://www.iov.one" target="_blank">Website</a></div></section><section class="copyright">Copyright © 2020 IOV</section></footer></div></body></html>